<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sinya Loyalty v7.66 完整版（含運費 / 逐月 / 活動 / 等級回饋）</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>Sinya Loyalty v7.66 完整版</h1>
  <p>校正公式＋新增運費＋逐月係數＋活動歸因＋等級購買回饋</p>
</header>

<main>
  <!-- 核心參數 -->
  <section class="card">
    <h2>一、核心參數</h2>
    <div class="grid">
      <label>毛利率（GM%）<input id="gm" type="number" step="0.01" placeholder="20"></label>
      <label>現金付款占比（%）<input id="pcash" type="number" step="0.01" placeholder="50"></label>
      <label>刷卡付款占比（%）<input id="pcard" type="number" step="0.01" placeholder="50"></label>
      <label>刷卡手續費率（%）<input id="cardfee" type="number" step="0.01" placeholder="1.8"></label>
    </div>
    <p class="hint">占比會自動正規化。所有％以整數輸入，計算時自動 ÷100。</p>
  </section>

  <!-- 年度目標與固定費 -->
  <section class="card">
    <h2>二、年度目標與固定費</h2>
    <div class="grid">
      <label>年度目標營收（含稅）<input id="sales_target" type="number" step="1" placeholder="12000000"></label>
      <label>年度目標毛利（GP 目標）<input id="gp_target" type="number" step="1" placeholder="300000"></label>
      <label>其他固定行銷費（年）<input id="other_mkt" type="number" step="1" placeholder="50000"></label>
    </div>
  </section>

  <!-- 等級與購買回饋 -->
  <section class="card">
    <h2>三、會員等級與購買回饋</h2>
    <div class="table-wrap">
      <table id="tbl_levels">
        <thead>
        <tr>
          <th>等級</th><th>人數</th><th>年均消費 ASP</th><th>現金回饋%</th><th>刷卡回饋%</th><th>刪除</th>
        </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
        <tr><td colspan="6"><button id="add_level">＋新增等級</button></td></tr>
        </tfoot>
      </table>
    </div>
    <details>
      <summary>其他回饋（生日 / UGC / 推薦）</summary>
      <div class="grid">
        <label>生日回饋（每人）<input id="bday_amt" type="number" step="1" placeholder="100"></label>
        <label>生日參與率（%）<input id="bday_part" type="number" step="0.01" placeholder="10"></label>
        <label>總會員數（人）<input id="members_total" type="number" step="1" placeholder="1000"></label>
        <label>UGC（每月）<input id="ugc_month" type="number" step="1" placeholder="10000"></label>
        <label>推薦（邀請人/單）<input id="ref_referrer" type="number" step="1" placeholder="100"></label>
        <label>推薦（被邀請人/單）<input id="ref_invitee" type="number" step="1" placeholder="100"></label>
        <label>推薦訂單數（年）<input id="ref_orders" type="number" step="1" placeholder="50"></label>
      </div>
    </details>
  </section>

  <!-- 活動歸因 -->
  <section class="card">
    <h2>四、活動歸因（逐月 uplift ）</h2>
    <div class="table-wrap">
      <table id="tbl_campaigns">
        <thead>
        <tr>
          <th>名稱</th><th>月份(1-12)</th><th>uplift%</th><th>影響支付</th><th>成本</th><th>刪除</th>
        </tr>
        </thead>
        <tbody></tbody>
        <tfoot><tr><td colspan="6"><button id="add_campaign">＋新增活動</button></td></tr></tfoot>
      </table>
    </div>
    <p class="hint">影響支付：全部 / 現金 / 刷卡。uplift 僅作用於該月的實際銷售。</p>
  </section>

  <!-- 逐月 KPI -->
  <section class="card">
    <h2>五、逐月 KPI（係數→目標、實際→達成）</h2>
    <div class="actions" style="justify-content:flex-start">
      <button id="coef_even" class="ghost">均衡模板（各 8.333%）</button>
      <button id="coef_q4" class="ghost">Q4 偏重模板</button>
    </div>
    <div class="table-wrap">
      <table id="tbl_months">
        <thead>
        <tr>
          <th>月</th><th>係數%</th><th>目標 Sales</th><th>實際 Sales</th><th>uplift 後 Sales</th><th>實際 GP</th>
        </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
        <tr class="sum">
          <td>合計</td>
          <td id="coef_sum">-</td>
          <td id="tgt_sum">-</td>
          <td id="act_sum">-</td>
          <td id="eff_sum">-</td>
          <td id="gp_sum">-</td>
        </tr>
        </tfoot>
      </table>
    </div>
  </section>

  <!-- 運費 -->
  <section class="card">
    <h2>六、運費</h2>
    <div class="grid">
      <label>件數（pcs）<input id="ship_count" type="number" step="1" placeholder="0"></label>
      <label>每件金額（含稅）<input id="ship_unit" type="number" step="1" placeholder="0"></label>
    </div>
  </section>

  <!-- 總結 -->
  <section class="card">
    <h2>七、總結結果</h2>
    <div class="results">
      <div><span>現金/刷卡占比（正規化）</span><strong id="norm_share">-</strong></div>
      <div><span>年 Sales（uplift 後合計）</span><strong id="out_sales">-</strong></div>
      <div><span>年 GP</span><strong id="out_gp">-</strong></div>
      <div><span>回饋（購買＋生日＋UGC＋推薦）</span><strong id="out_rebate">-</strong></div>
      <div><span>刷卡費</span><strong id="out_cardfee">-</strong></div>
      <div><span>活動成本（合計）</span><strong id="out_campaign">-</strong></div>
      <div><span>其他固定行銷費</span><strong id="out_othermkt">-</strong></div>
      <div><span>運費</span><strong id="out_shipping">-</strong></div>
      <div class="net"><span>淨效益（Net）</span><strong id="out_net">-</strong></div>
      <div><span>營收達成率</span><strong id="out_sales_attain">-</strong></div>
      <div><span>Net / 目標毛利</span><strong id="out_net_vs_gptarget">-</strong></div>
    </div>
    <div class="actions">
      <button id="btn_calc">立即計算</button>
      <button id="btn_reset" class="ghost">重置</button>
    </div>
    <p class="hint small">恒等式檢查：應有 GP = Net + 回饋 + 刷卡費 + 活動 + 其他行銷 + 運費（若不平衡會在 Console 提示差額）。</p>
  </section>
</main>

<footer><p>© 2025 Sinya Loyalty v7.66 完整版</p></footer>

<script src="app.js"></script>
</body>
</html>
